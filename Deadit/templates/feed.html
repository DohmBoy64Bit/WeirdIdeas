{% extends "base.html" %}

{% block content %}
<div class="main-content-flex">
    <!-- Sidebar -->
    <aside class="sidebar">
        <h3><i class="fas fa-brain"></i> Trending Subdeadits</h3>
        <ul class="subdeadit-list">
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='BrainsGoneWild') }}">r/BrainsGoneWild</a>
                <span class="subscribers">2.3M shamblers</span>
            </li>
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='FreshMeat') }}">r/FreshMeat</a>
                <span class="subscribers">1.8M shamblers</span>
            </li>
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='MoanHelpDesk') }}">r/MoanHelpDesk</a>
                <span class="subscribers">950K shamblers</span>
            </li>
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='ZombieSurvival') }}">r/ZombieSurvival</a>
                <span class="subscribers">745K shamblers</span>
            </li>
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='ShambleSports') }}">r/ShambleSports</a>
                <span class="subscribers">620K shamblers</span>
            </li>
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='AskRottingOnes') }}">r/AskRottingOnes</a>
                <span class="subscribers">540K shamblers</span>
            </li>
            <li>
                <a href="{{ url_for('main.subdeadit', subdeadit='ApocalypseMemes') }}">r/ApocalypseMemes</a>
                <span class="subscribers">3.1M shamblers</span>
            </li>
        </ul>

        <div class="rules">
            <h3><i class="fas fa-book-dead"></i> Community Rules</h3>
            <ol class="rules-list">
                <li>No discrimination based on decomposition level</li>
                <li>Keep moans to a reasonable volume</li>
                <li>No sharing survivor bunker locations</li>
                <li>Tag NSFB (Not Safe For Brains) appropriately</li>
                <li>Respect the newly turned</li>
                <li>No false "cure" claims</li>
            </ol>
        </div>
    </aside>

    <!-- Main Posts Container -->
    <div class="posts-container">
        <h2 style="color: var(--undead-green); margin-bottom: 20px;">
            {{ title }}
        </h2>

        {% if current_subdeadit %}
        <div style="margin-bottom: 25px;">
            <a href="{{ url_for('main.create_post', subdeadit=current_subdeadit) }}" class="btn btn-primary"
                style="padding: 10px 20px; font-size: 1rem;">
                <i class="fas fa-plus-circle"></i> Start Moaning in {{ title }}
            </a>
        </div>
        {% endif %}

        {% for post in posts %}
        <article class="post">
            <!-- Voting Section -->
            <div class="vote-section" data-item-type="post" data-item-id="{{ post.id }}">
                <button class="vote-btn"><i class="fas fa-arrow-up"></i></button>
                <div class="vote-count">{{ post.upvotes }}</div>
                <button class="vote-btn downvote"><i class="fas fa-arrow-down"></i></button>
            </div>

            <!-- Post Content -->
            <div class="post-content">
                <div class="post-meta">
                    <a href="{{ url_for('main.subdeadit', subdeadit=post.subdeadit.replace('r/', '')) }}"
                        class="subdeadit">{{
                        post.subdeadit }}</a>
                    <span class="posted-by">Posted by u/{{ post.author.username }} â€¢ {{
                        post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    {% if post.flair %}
                    <span class="flair"
                        style="background: var(--rotten-brown); padding: 2px 8px; border-radius: 10px; font-size: 0.7rem;">{{
                        post.flair }}</span>
                    {% endif %}
                </div>

                <h2 class="post-title"><a href="{{ url_for('main.post_detail', post_id=post.id) }}"
                        style="color: inherit; text-decoration: none;">{{ post.title }}</a></h2>

                <div class="post-body">
                    {{ post.body[:200] }}{% if post.body|length > 200 %}...{% endif %}
                </div>

                <div class="post-actions">
                    <button class="post-action"><i class="fas fa-comment"></i> {{ post.comments.count() }}
                        Moans</button>
                    <button class="post-action"><i class="fas fa-share"></i> Share</button>
                    <button class="post-action"><i class="fas fa-bookmark"></i> Save</button>
                </div>
            </div>
        </article>
        {% else %}
        <div class="post">
            <div class="post-content">
                <p>No moans here yet. Be the first to break the silence!</p>
                <div style="margin-top: 15px;">
                    {% if current_user.is_authenticated %}
                    {% if not current_subdeadit %}
                    <a href="{{ url_for('main.create_post') }}" class="btn btn-primary">Start Moaning</a>
                    {% endif %}
                    {% else %}
                    <p style="color: var(--text-decay); font-style: italic;">
                        <a href="{{ url_for('auth.login') }}">Login</a> or <a href="{{ url_for('auth.register') }}">Join
                            the Horde</a> to start moaning!
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}